window.downgradeOrUpgrade=async A=>Swal.fire({title:'Are you sure you want to switch plan?',showCancelButton:!0,confirmButtonText:'Yes, switch it!'}).then(_=>_.isConfirmed&&(Swal.showLoading(),fetch(`https://bildzeitschrift.netlify.app/.netlify/functions/subscription?upgrade=true&sub=${A}`,{method:'PUT',headers:{Authorization:sessionStorage.getItem('auth')}}).then(b=>b.ok&&fetch('https://bildzeitschrift.netlify.app/.netlify/functions/subscription',{method:'GET',headers:{Authorization:sessionStorage.getItem('auth')}}).then(async B=>{let c=[{name:'Starter',price:5,active:!1,description:'Das Starter Abo erlaubt es dir, den Filter zur Gänze zu nutzen und somit das Archiv bis ins letzte Details filtern zu können.',price_id:'price_1OsJmuSA2e71Dz91jqdMYH0V'},{name:'Inspiration',price:8,active:!1,description:'In diesem Abo hast du einerseits die Möglichkeit, den Filter zur Gänze zu nutzen und andererseits deine eigenen Kollektionen von Magazinen zu speichern. Deine Kollektionen kannst du dann auch in einem Präsentationsmodus abspielen.',price_id:'price_1OqG9PSA2e71Dz91HaJFV0xb'}];var C=await B.json();if(C.plan){var d=C.plan;let _a=c.find(D=>D.name==d.plan);_a.active=!0;_a['end_date']=`${new Date(d.end_date*1000)}`;_a['sub_id']=d.subscription;d.hasOwnProperty('downgrade')&&(_a['downgraded']=!0);d.hasOwnProperty('cancel_at_end')&&(_a['cancel_at_end']=!0);a(c,!0,d.subscription)}})),Swal.close()));window.createCheckout=async _A=>{let _b=await Swal.fire({title:'Are you sure you want to buy this plan?',showCancelButton:!0,confirmButtonText:'proceed to checkout'});if(_b.isConfirmed){Swal.showLoading();let e=await fetch(`https://bildzeitschrift.netlify.app/.netlify/functions/create_checkout?price_id=${_A}`,{method:'GET',headers:{Authorization:sessionStorage.getItem('auth')}});let _B=await e.json();Swal.close();location.assign(_B.checkout_link)}};window.cancelPlan=async E=>{let aA=await Swal.fire({title:'Are you sure you want to cancel this plan?',showCancelButton:!0,cancelButtonText:'No',confirmButtonText:'Yes cancel'});if(aA.isConfirmed){let aB=await fetch(`https://bildzeitschrift.netlify.app/.netlify/functions/subscription?sub_id=${E}`,{method:'DELETE',headers:{Authorization:sessionStorage.getItem('auth')}});aB.status==200&&fetch('https://bildzeitschrift.netlify.app/.netlify/functions/subscription',{method:'GET',headers:{Authorization:sessionStorage.getItem('auth')}}).then(async aC=>{let aD=[{name:'Starter',price:5,active:!1,description:'Das Starter Abo erlaubt es dir, den Filter zur Gänze zu nutzen und somit das Archiv bis ins letzte Details filtern zu können.',price_id:'price_1OsJmuSA2e71Dz91jqdMYH0V'},{name:'Inspiration',price:8,active:!1,description:'In diesem Abo hast du einerseits die Möglichkeit, den Filter zur Gänze zu nutzen und andererseits deine eigenen Kollektionen von Magazinen zu speichern. Deine Kollektionen kannst du dann auch in einem Präsentationsmodus abspielen.',price_id:'price_1OqG9PSA2e71Dz91HaJFV0xb'}];var _c=await aC.json();if(_c.plan){var _d=_c.plan;let aE=aD.find(aF=>aF.name==_d.plan);aE.active=!0;aE['end_date']=new Date(_d.end_date*1000).toLocaleString();aE['sub_id']=_d.subscription;if(_d.hasOwnProperty('downgrade'))aE['downgraded']=!0;if(_d.hasOwnProperty('cancel_at_end'))aE['cancel_at_end']=!0;a(aD,!0,_d.subscription)}})}};function a(aG,aH,_C){var _D=document.querySelectorAll('.subs-wrap'),_e=_D[0],f=_D[1];_e.innerHTML='<h2 class=\'subs-head\'>Dein aktuelles Abo</h2>';f.innerHTML='<h2 class=\'subs-head\'>Weitere Abonnements</h2>';for(let i=0;i<aG.length;i++)if(aG[i].active){var g=`
            <div class="subs-wrapper">
                <div class="subs-wrap-inner">
                    <h3 class="subs-head">${aG[i].name}</h3>
                    <div>
                        <span class="price-span">€ ${aG[i].price},00</span> / Monat
                    </div>
                    <a onclick=cancelPlan('${_C}') class="button subs-cancel w-inline-block" style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg); transform-style: preserve-3d;">
                        <div class="button-text subs">Kündigen</div>
                    </a>
                </div>
                <div class="subs-wrap-inner">
                    <p class="subs-p">${aG[i].description}</p>
                    <span>${aG[i].cancel_at_end?'Cancelled from next month':`Renews on : ${aG[i].end_date}`}</span>
                </div>
            </div>`;_e.insertAdjacentHTML('beforeend',g)}else{var g=`
            <div class="subs-wrapper">
                <div class="subs-wrap-inner">
                    <h3 class="subs-head">${aG[i].name}</h3>
                    <div>
                        <span class="price-span" data-moz-translations-id="0">€ ${aG[i].price},00</span> / month
                    </div>
                    <a  onclick=${aH?`downgradeOrUpgrade('${_C}')`:`createCheckout('${aG[i].price_id}')`} class="button subs-change w-inline-block" style="transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg); transform-style: preserve-3d;">
                        <div class="button-text subs">${aH?'Switch to '+aG[i].name:'Choose this plan'}</div>
                    </a>
                </div>
                <div class="subs-wrap-inner">
                    <p class="subs-p">${aG[i].description}</p>
                </div>
            </div>`;f.insertAdjacentHTML('beforeend',g)}}(async ()=>{let aI=[{name:'Starter',price:5,active:!1,description:'Das Starter Abo erlaubt es dir, den Filter zur Gänze zu nutzen und somit das Archiv bis ins letzte Details filtern zu können.',price_id:'price_1OsJmuSA2e71Dz91jqdMYH0V'},{name:'Inspiration',price:8,active:!1,description:'In diesem Abo hast du einerseits die Möglichkeit, den Filter zur Gänze zu nutzen und andererseits deine eigenen Kollektionen von Magazinen zu speichern. Deine Kollektionen kannst du dann auch in einem Präsentationsmodus abspielen.',price_id:'price_1OqG9PSA2e71Dz91HaJFV0xb'}];document.addEventListener('DOMContentLoaded',async ()=>{let aJ=await fetch('https://bildzeitschrift.netlify.app/.netlify/functions/subscription',{method:'GET',headers:{Authorization:sessionStorage.getItem('auth')}});if(aJ.ok){var aK=await aJ.json();if(aK.plan){var aL=aK.plan;let aM=aI.find(aN=>aN.name==aL.plan);aM.active=!0;aM['end_date']=new Date(aL.end_date*1000).toLocaleString();aM['sub_id']=aL.subscription;aL.hasOwnProperty('downgrade')&&(aM['downgraded']=aL.downgraded);aL.hasOwnProperty('cancel_at_end')&&(aM['cancel_at_end']=aL.cancel_at_end);a(aI,!0,aL.subscription)}else a(aI,!1)}})})().then();
